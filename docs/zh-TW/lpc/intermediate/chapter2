¤¤¶¥ LPC
Descartes of Borg
Novermber 1993

			²Ä¤G³¹: LPMud driver

2.1 ¦^ÅU°ò¥»ªº driver/mudlib ¶¡ªº¤¬°Ê

¦b°òÂ¦ LPC  ½Ò¥»¸Ì, §A¾Ç¨ì«Ü¦h mudlib ¤u§@ªº¤è¦¡, ¤×¨ä¬OÃö©ó§A¬°¤F«Ø³y
°Ï°ì©Ò¼¶¼gªºª«¥ó. ¦Ó mudlib ©M driver ¶¡ªº¤¬°Ê°Q½×±o¨Ã¤£¦h. ¤£¹L, §AÀ³
¸Óª¾¹D driver °µ¤F¥H¤Uªº¨Æ:

1)  ·í¤@­Óª«¥ó²Ä¤@¦¸³Q¸ü¤J°O¾ÐÅé, ­ì©l¼Ò¦¡ mud  ªº driver ·|©I¥s 
    create(), ¦ÓºëÂ²¼Ò¦¡ mud  ·|©I¥s reset(). ³Ð§@ªº¤H¨Ï¥ create()  ©Î 
    reset() µ¹¤©ª«¥óªì©l­È.

2)  ¨C¨ì¹CÀ¸ºÞ²zªÌ³]©wªº¶g´Á, driver  ©I¥s reset()  ¨ç¦¡. ³o¼ËÅýª«¥ó¯à
    ­«·s²£¥Í©Çª«¤§ÃþªºªF¦è. ½Ðª`·N, ¦bºëÂ²¼Ò¦¡ªº mud  ¤¤, ¦P¤@­Ó¨ç¦¡¤£
    ¦ý¥Î©ó­«·s³]©w©Ð¶¡, ¤]¥Î©ó³]©wªì©l­È. 

3)  ¥ô¦ó®É­Ô, ¤@­Ó¬¡ª«¥ó (living object)  ¹J¨ì¥t¤@­Óª«¥ó®É, driver  ©I
    ¥s·s¹J¨ìª«¥óªº init() ¨ç¦¡. ³o¼Ë¥i¥HÅý·s¹J¨ìªºª«¥ó³z¹L add_action() 
    ¥~³¡¨ç¦¡ (efun) µ¹¤©¬¡ª«¥ó¥i¥H°õ¦æªº©R¥O, ¦P¼Ë¤]¥i¥H°õ¦æ¨ä¥Lªº°Ê§@, 
    ¦Ó³o¨Ç°Ê§@¬O¤@­Ó¬¡ª«¥ó¸I¨ì¦¹¤@ª«¥ó®É©Ò¸Óµo¥Íªº¨Æ.

4)  driver  ©w¸q¤F¤@®MºÙ¬°¥~³¡¨ç¦¡ªº¨ç¦¡, ¦b¹CÀ¸¤¤©Ò¦³ªºª«¥ó³£¥i¥H¨Ï¥Î
    ¥¦­Ì. Á|¨Ò¨Ó»¡, ±`¥Îªº¥~³¡¨ç¦¡¦³: this_player(), this_object(), 
    write(), say(), ¥H¦¹Ãþ±À.

2.2 driver ¶g´Á (cycle)

driver  ¬O°õ¦æ¹CÀ¸ªº C  µ{¦¡. ¥¦ªº°ò¥»¥\¯à¬O±µ¨ü¥~¬Éªº³s½u, Åý¤H¯àµn¿ý
(login) ¡B¸ÑÄ¶©w¸q LPC  ª«¥ó©M¥¦­Ì¦b¹CÀ¸¤¤§@¥Îªº LPC  µ{¦¡½X¡B±µ¨ü¨Ï¥Î
ªÌªº¿é¤J¨Ã©I¥s¾A·íªº LPC  ¨ç¦¡¥H°t¦X¨Æ¥óµo¥Í. ¥¦³ÌÂ²³æªº­n¯À´N¬O, ¥¦¬O
¤@­Ó¥Ã¤£²×¤î°j°é (loop).

¤@¥¹¹CÀ¸±Ò°Ê, ¨Ã¥B¥¿½T¦a°õ¦æ¥\¯à (¥H«á·|¦b°ª¶¥ LPC  ½Ò¥»¤¤°Q½×±Ò°Êµ{§Ç)
, driver  ´N¶i¤J¤@­Ó°j°é. °£«D¦Xªk©I¥s shutdown() ¥~³¡¨ç¦¡, ©Î¸I¤W¯äÂÎ
Åý driver ±YÃa (crash), ¦¹°j°é¤£·|²×¤î. ¤@¶}©l, driver  ±±¨î¥ô¦ó·s¶iªº
³s½u, ¨Ã§â³s½u¥æµ¹µn¿ýª«¥ó (login). ¤§«á, driver  §â©Ò¦³¨Ï¥ÎªÌ¿é¤Jªº©R
¥O©ñ¤J¤@­Ó©R¥Oªí (table of commands), ¦¹®É¤w¬O driver ªº³Ì«á¤@­Ó¶g´Á.
¦b²Õ¦X©R¥Oªí¤§«á, ©Ò¦³±q driver ³Ì«á¤@­Ó¶g´Á±Æ©w­n°eµ¹³s½uªº°T®§, ´N°e
µ¹¨Ï¥ÎªÌ. ¦¹®É, driver  ¨Ì§Ç°õ¦æ©R¥Oªí¤¤ªº©R¥O, ¨Ã°õ¦æ¨C­Óª«¥ó©ñ¦b©R¥O
ªí¤¤ªº¦U®M©R¥O. driver  ¦b¶g´Áµ²§ô®É, ©I¥s¨C¤@­Ó¦³ heart_beat() ¨ç¦¡ªº
ª«¥ó, °õ¦æ¨ä¤¤ªº heart_beat() ¨ç¦¡. ³Ì«á, °õ¦æ©Ò¦³µ¥«Ýªº©µ¿ð©I¥s 
(call out). ¥»³¹¤£°Q½×³s½u±±¨î, ¥»³¹µJÂI©ñ¦b driver ¦p¦ó±±¨î¨Ï¥ÎªÌ©R¥O
¡B¤ß¸õ (heartbeat)¡B©µ¿ð©I¥s.º

2.3 ¨Ï¥ÎªÌ©R¥O

¦p¦P 1.2  ¤¤©Ò´£, driver  ¦b¨C­Ó¶g´Á¤¤, §â¨C¤@­Ó¨Ï¥ÎªÌ­n°õ¦æªº©R¥OÀx¦s
¦b©R¥Oªí¸Ì. ©R¥Oªí¸ÌÀY¦³°õ¦æ¦¹©R¥Oªº¬¡ª«¥ó¦WºÙ¡Bµ¹¤©¬¡ª«¥ó¦¹¤@©R¥Oªºª«
¥ó¡B­n°õ¦æ¦¹©R¥O®É©Ò°õ¦æªº¨ç¦¡. driver  §â¿é¤J©R¥Oªºª«¥ó·í§@¬Oµ¹¤©©R¥O
ªÌ. ¤j¦h¼Æªº®É­Ô, ³o´N¬O this_player()  ©Ò¶Ç¦^ªºµ¹¤©©R¥OªÌ.

driver  ¥Ñ¦³©µ¿ð©R¥Oªº¬¡ª«¥óªíªºÀYºÝ¶}©l, ±µµÛ°õ¦æ©R¥O, ©I¥s³o¨Ç¬¡ª«¥ó
¿é¤Jªº©R¥O¬ÛÃöªº¨ç¦¡, ¨Ã¶Ç¤Jµ¹¤©©R¥OªÌµ¹¨ç¦¡ªº¥ô¦ó°Ñ¼Æ. ·í driver ¥Ñ·s
ªº¬¡ª«¥ó©Òµ¹ªº©R¥O¶}©l®É, µ¹¤©©R¥OªÌÅÜ¼Æ´N§ï¬°·sªº¬¡ª«¥ó, ³o¼Ë¦b©R¥O¶}
©l¨Ì§Ç°õ¦æ¨ç¦¡®É, this_player() ¥~³¡¨ç¦¡¤~¯à¶Ç¦^µ¹¤©©R¥Oªºª«¥ó.

¨Ó¬Ý¬Ý¤@­Óª±®aªº©R¥O¼È¦s°Ï½d¨Ò. ¦b¤@­Ó¥s°µ Bozo ªºª±®a°õ¦æ³Ì«á¤@­Ó©R¥O
®É, ¥L¿é¤J "north"  ©M "tell descartes  ¤U¦¸­«·s¶}¾÷¬O¤°»ò®É­Ô ?". 
"north" ©R¥O»P Bozo ©Ò¦b©Ð¶¡¸Ìªº "Do_Move()"  ¨ç¦¡¬ÛÃö ("north" ©R¥O¥Ñ
¦¹©Ð¶¡ªº set_exits()  ¥~³¡¨ç¦¡¦Û°Ê³]©w). "tell" ©R¥O¨Ã¨S¦³¯S§O¦C¦bª±®a
©Ò¥i¥H¨Ï¥Îªº©R¥O¤¤, ¦Ó¦bª±®aª«¥ó¤¤¦³¤@­Ó¥s°µ "cmd_hook()" ªº¨ç¦¡, ¤ñ¹ï
ª±®a¥i¯à¿é¤Jªº©R¥O.

·í driver ³B²z¨ì Bozo,  µ¹¤©©R¥OªÌªºÅÜ¼Æ´N³]©w¬° Bozo ³o­Óª«¥ó. µM«á, 
¬Ý¨ì Bozo ¿é¤J "north", ¤]¬Ý¨ì»P "north"  ¬ÛÃöªº¨ç¦¡, «h driver ©I¥s
Bozo's_room->Do_Move(0)  (Bozo  ©Ò¦b©Ð¶¡ªº Do_Move() ¨ç¦¡). ¦]¬° Bozo 
¥u¿é¤J "north"  ©R¥O, ¨S¦³¥[¤W°Ñ¼Æ, ©Ò¥H¥Î°Ñ¼Æ 0  ¶Ç¤J¦¹¨ç¦¡. ¦¹©Ð¶¡¥­
±`·|©I¥s¤@¨Ç¥¦»Ý­nªº¨ç¦¡, ¦¹®É this_player()  ¥~³¡¨ç¦¡©Ò¶Ç¦^ªºª«¥ó´N¬O
Bozo. ³Ì«á, ¦¹©Ð¶¡ª«¥ó·|©I¥s Bozo ¤¤ªº move_player(), ¤§«á©I¥s
move_object() ¥~³¡¨ç¦¡. ³o­Ó¥~³¡¨ç¦¡­t³d§ïÅÜ¤@­Óª«¥óªºÀô¹Ò.

·í¤@­Óª«¥óªºÀô¹Ò§ïÅÜ®É, ·|§R°£«e¤@­ÓÀô¹Ò¤¤¨ä¥Lª«¥ó©M«e¤@­ÓÀô¹Ò¤¤¹ï¥¦¥[
¤Wªº¥i¥Î©R¥O. §R°£¤§«á, driver  ©I¥s·sÀô¹Ò©M·sÀô¹Ò¤¤¨C¤@­Óª«¥óªº init() 
¥~³¡¨ç¦¡. ¨C¤@¦¸©I¥s init() ®É, Bozo  ª«¥ó¤´µM¬Oµ¹¤©©R¥OªÌ. ©Ò¥H¦¹¦¸²¾
°Ê©Ò¦³ªº add_action() ¥~³¡¨ç¦¡·|¥[¦b Bozo ¨­¤W. §¹¦¨©Ò¦³ªº©I¥s«á, ±±¨î
Åv±q move_object()  ¥æµ¹ Bozo ªº move_player()  °Ï°ì¨ç¦¡. move_player() 
±N±±¨îÅv¥æ¦^µ¹ÂÂ©Ð¶¡ªº Do_Move(), Do_Move() ¶Ç¦^ 1  µ¹ driver,  ¥Hªí¥Ü
¦¹©R¥Oªº°Ê§@§¹¦¨. ¦pªG Do_move()  ¦]¬°¬Y¨Ç­ì¦]¶Ç¦^ 0, «h driver ·|¹ï
Bozo Åã¥Ü "¤°»ò?" (©Î¬O§Aªº driver ©Ò¹w³]ªº¿ù»~©R¥O°T®§).

¤@¥¹²Ä¤@­Ó©R¥O¶Ç¦^ 1, driver  ´NÄ~Äò³B²z Bozo ªº²Ä¤G­Ó©R¥O, ¹Lµ{´N¸ò²Ä
¤@­Ó¤@¼Ë. ½Ðª`·N, driver  §â  "tell descartes ¤°»ò®É­Ô­«·s¶}¾÷ ?" ªº 
"descartes  ¤°»ò®É­Ô­«·s¶}¾÷ ?" ·í§@°Ñ¼Æ¶Çµ¹¸ò tell ¬ÛÃöªº¨ç¦¡. ³o­Ó¨ç
¦¡¨M©w­n¦p¦ó³B²z³o­Ó°Ñ¼Æ. ³o­Ó©R¥O¤§«á¶Ç¦^ 1  ©Î 0, driver  ¦AÄ~Äò³B²z
¤U¤@­Ó¦³©µ¿ð©R¥Oªº¬¡ª«¥ó, µM«á¥H¦P¼Ëªº¨BÆJ³B²z¥þ³¡¦³©µ¿ð©R¥Oªº¬¡ª«¥ó, 
°õ¦æ¥¦­Ìªº©R¥O.

2.4 set_heart_beat() ©M call_out() ¥~³¡¨ç¦¡

¤@¥¹¦³©µ¿ð©R¥Oªºª«¥ó¨ä¥þ³¡ªº©R¥O°õ¦æ§¹¦¨«á, driver  ´NÄ~Äò©I¥s©Ò¦³
driver  ¦C¬°¦³¤ß¸õ¤§ª«¥ó¤¤ªº heart_beat() ¨ç¦¡. ¥u­n¤@­Óª«¥ó¥H«D¹s°Ñ¼Æ
©I¥s set_heart_beat() ¥~³¡¨ç¦¡ (µø§Aªº driver ¦Ó©w, «D¹sªº¼Æ¦r¤]³\«Ü­«
­n, ¦ý¬O¦b¤j¦hªº±¡ªp¤U¬°¾ã¼Æ 1 ), set_heart_beat()  ¥~³¡¨ç¦¡§â©I¥s 
set_heart_beat()  ªºª«¥ó¥[¦b¦³¤ß¸õª«¥óªº¦Cªí¤W. ¦pªG§A¥H 0  ¬°°Ñ¼Æ©I¥s
¥¦, ¥¦´N§â¦¹ª«¥ó±q¦³¤ß¸õª«¥óªºªí¤W§R°£.

¤ß¸õ¦b mudlib ¸Ì³Ì±`¨£ªº¥Î³~¬OªvÀøª±®a©M©Çª«¡B°õ¦æ¾Ô°«. ¤@¥¹ driver ³B
²z§¹©R¥O¦Cªí, ¥¦´N¶}©l¬Ý¤ß¸õ¦Cªí, ©I¥sªí¤W¨C¤@­Óª«¥óªº heart_beat(). 
©Ò¥HÁ|¨Ò¨Ó»¡, ¹ïª±®a¦Ó¨¥, driver  ·|©I¥sª±®a¸Ì­±ªº heart_beat() ¥H°õ¦æ
¥H¤U¥\¯à:

1)  Åýª±®aÅÜ¦Ñ
2)  ¨Ì·ÓªvÀø³t²vªvÀøª±®a.
3)  ÀË¬d¥|©P¬O§_¦³¥ô¦ó³Q¤HÂy±þ¡B¥¿¦bÂy±þ¤H¡B©Î¥¿¦b§ðÀ»¤Hªºª«¥ó
4)  ¦pªG²Ä¤TÂI¦¨¥ß, ¶}©l§ðÀ».
5)  ¨ä¥L»Ý­n¨C¬íÄÁ¦Û°Êµo¥Íªº¨Æ.

½Ðª`·N, ¦³¤ß¸õªºª«¥ó¶V¦h, mud ¨C­Ó¶g´Á»Ý­n³B²zªº®É¶¡¤]´N¶V¤[. ¦³¤ß¸õªº
ª«¥ó¤wª¾¬O mud  ³g¨D CPU  ®É¶¡³Ì¥D­nªº¦]¯À.

call_out()  ¥~³¡¨ç¦¡¥Î©ó°õ¦æ¤£»Ý­n¹³¤ß¸õ¤@¼Ë±`±`µo¥Í¡B©Î¥uµo¥Í¤@¦¸ªº­p
®É¨ç¦¡©I¥s. ©µ¿ð©I¥s (call out) Åý§A«ü©w©I¥s¤@­Óª«¥ó¤¤ªº¬Y­Ó¨ç¦¡. ¤@¯ë
©µ¿ð©I¥sªº¤½¦¡¬°:

call_out( func, time, args );

²Ä¤T­Ó«ü©w°Ñ¼Æªº°Ñ¼Æ¨Ã«D¥²­n. ²Ä¤@­Ó°Ñ¼Æ¬O¤@­Ó¦r¦ê, ¥Nªí³Q©I¥sªº¨ç¦¡¦W
ºÙ. ²Ä¤G­Ó°Ñ¼Æ¬O¸g¹L´X¬í¤§«á¤~©I¥s¨ç¦¡.

¹ê»Ú¤W¨Ó»¡, ·í¤@­Óª«¥ó©I¥s call_out() ®É, ¥¦´N³Q¥[¨ì¤@­Ó©µ¿ð©I¥sªºª«¥ó
ªí¤¤, ¦¹ªí¤¤°O¦³©µ¿ð©I¥sªºÁ`©µ¿ð®É¶¡, ©M±ý©I¥sªº¨ç¦¡¦WºÙ. driver  ªº¨C
¤@­Ó¶g´Á, ´N·|¶i¦æ­Ë¼Æ, ª½¨ì©I¥s¨ç¦¡ªº®É¶¡. ®É¶¡¤@¨ì, driver  §â¦¹ª«¥ó
±q©µ¿ð©I¥sªí¤W§R°£, ¨Ã°õ¦æ©I¥s©µ¿ð©I¥s¨ç¦¡, ¶Ç¤J­ì¥»©µ¿ð©I¥s¨ç¦¡©Ò«ü©w
ªº°Ñ¼Æ.

¦pªG§A·Q¦b¤@­Ó©µ¿ð©I¥s°õ¦æ«e±N¨ä§R°£, §A»Ý­n¥Î remove_call_out()  ¥~³¡
¨ç¦¡, ¶Ç¤J©µ¿ð©I¥sªº¨ç¦¡¦WºÙ. driver  ·|§R°£¤U¤@¦¸©µ¿ð©I¥sªº³o­Ó¨ç¦¡. 
³oªí¥Ü¦pªG¦P¤@­Ó¨ç¦¡¦³¤@­Ó¥H¤Wªº©µ¿ð©I¥s, ´N·|¥X²{¼ÒÀÀ¨â¥iªº±¡ªp.

­nÅý¤@­Ó©µ¿ð©I¥s´`Àô°õ¦æ, §A¥²¶·¦b§A©µ¿ð©I¥sªº¨ç¦¡¤¤¦A¨Ï¥Î call_out() 
¥~³¡¨ç¦¡, ¦]¬° driver °õ¦æ§¹©µ¿ð©I¥s«á, ·|¦Û°Ê§â¨ç¦¡±q©µ¿ð©I¥sªí¤¤§R°£.
Á|¨Ò:

void foo() { call_out("hello", 10); }

void hello() { call_out("hello", 10); }

¦b foo()  ²Ä¤@¦¸³Q©I¥s«á, ¨C 10 ¬í©I¥s hello()  ¤@¦¸. ¦b¦¹¦³´X¥ó¨Æ­nª`
·N. ²Ä¤@, §A¥²¶·­n¤p¤ß, ½T©w§Aªº©µ¿ð©I¥s¤£·|³y¦¨¥ô¦ó¤£¥¿½Tªº»¼°j¤è¦¡. 
²Ä¤G, ¤ñ¸û set_heart_beat() ©M call_out() ©Ò°µªº¨Æ¦³¦ó¤£¦P.

set_heart_beat():

a)  ±N this_object()  ¥[¦b¤ß¸õª«¥ó¦Cªí¤¤
b)  ¨C¤@¦¸ driver ¶g´Á©I¥s this_object() ¤¤ªº heart_beat() ¨ç¦¡

call_out():

a)  ±N this_object() ¡Bthis_object() ¤¤ªº¨ç¦¡¦WºÙ¡B©µ¿ð®É¶¡¡B¤@²Õ°Ñ¼Æ, 
    ¥[¦b©µ¿ð©I¥s¨ç¦¡ªº¦Cªí¤W
b)  «ü©w¦WºÙªº¨ç¦¡¥u©I¥s¤@¦¸, ¦b©µ¿ð¤@¬q«ü©wªº®É¶¡«á, °õ¦æ¦¹¦¸©I¥s

§A¥i¥H¬Ý¨ì, ©µ¿ð©I¥sªº (a)  ³¡¤À¦³«ÜÃe¤jªº°O¾ÐÁ`¶q (memory overhead),
¦Ó¤ß¸õªº (b)  ³¡¤À«h¦³§óÃe¤jªº CPU  Á`¶q, °²³]©µ¿ð©I¥sªº©µ¿ð®É¶¡­n¤ñ¤@
¦¸ driver ¶g´Á¨Ó±oªø.

«Ü©úÅã, §A¤£·|°õ¦æ©µ¿ð¤@¬íªº©µ¿ð©I¥s, §_«h§A·|©ì«±¨âªÌ. ¦P¼Ë, §A¤]¤£§Æ
±æÀ³¸Ó¨Ï¥Î¤ñ¤@¬íÄÁªøªº©µ¿ð©I¥s¶g´Á¨Ó¹F¦¨ªº¥\¯à¥X²{¦b¤ß¸õ¤¤. §Ú­Ó¤HÅ¥¹L
¤@ºØ½×ÂI, »{¬°§AÀ³¸Ó¦h¨Ï¥Î©µ¿ð©I¥s. §Ú³Ì±`Å¥¨ìªº¬O, ³æ¤@©I¥s©Î¤ñ¤Q¬íªø
ªº¶g´Á³Ì¦n¨Ï¥Î©µ¿ð©I¥s. ¤Q¬í¥H¤ºªº¶g´Á©Ê©I¥s, §A³Ì¦n¨Ï¥Î¤ß¸õ. §Ú¨Ã¤£ª¾
¹D³oºØ»¡ªk¬O§_¥¿½T, ¦ý¬O§Ú¤]¤£»{¬°¿í·Ó³oºØ§@ªk·|³y¦¨¥ô¦ó·l®`.

2.5 Á`µ²

°ò©ó§ó²`¤J¤F¸Ñ LPC, ©M¤F¸Ñ driver ©M mudlib ¶¡ªº¤¬°Ê. §A²{¦bÀ³¸Óª¾¹D
driver  °õ¦æ¨ç¦¡ªº¶¶§Ç, ¨Ã¤F¸Ñ¦³Ãö this_player()¡Badd_action()¡B
move_object() ¥~³¡¨ç¦¡©M init() °Ï°ì¨ç¦¡§ó¦hªº²Ó¸`. ¥t¥~, ®Ú¾Ú¥H©¹§A
±q°òÂ¦ LPC  ½Ò¥»¾Ç±oªºª¾ÃÑ, ¥»³¹¥H driver ¦p¦ó±±¨î©µ¿ð©I¥s©M¤ß¸õ¨Ó¤¶
²Ð¥¦­Ì. §A²{¦bÀ³¸Ó¹ï©µ¿ð©I¥s©M¤ß¸õ¦³°ò¥»ªº»{ÃÑ, ¨Ã¥i¥H¦b§Aªºµ{¦¡½X¤¤
¹êÅç¤@¤U.

Copyright (c) George Reese 1993

Ä¶ªÌ: Spock of the Final Frontier	98.Jul.22.
