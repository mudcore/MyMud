/*****************************************************************************
Copyright: 2019, Mud.Ren
File name: area_d.c
Description: 游戏区域怪物守护进程
Author: xuefeng
Version: v1.0   Date: 2019-03-12
*****************************************************************************/
int *slice(int *mob, int range);
nosave mixed area_mob = ({
    ({}),
    ({1, 2, 3, 4, 5, 6, 7}),
    ({1, 6, 7, 8, 9, 10, 11}),
    ({12, 13, 14, 15, 16, 17, 21, 23}),
    ({5, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25}),
    ({20, 21, 22, 24, 25, 26, 27, 28}),
    ({27, 28, 29, 30, 31, 32}),
    ({30, 33, 34, 35, 36, 37, 38, 39}),
    ({29, 34, 35, 36, 37, 38, 39, 40, 41, 42, 101}),
    ({42, 43, 44, 45, 46}),
    ({43, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56}),
    ({48, 50, 51, 53, 54, 55, 56, 57, 204}),
    ({41, 52, 58, 59, 60, 61, 62}),
    ({58, 59, 60, 62, 63, 64, 65, 66, 67, 107}),
    ({57, 63, 64, 66, 67, 68, 69, 74}),
    ({68, 69, 70, 71, 72, 74}),
    ({71, 73, 75, 76, 77, 78}),
    ({72, 78, 79, 80, 81, 82, 86, 90, 93}),
    ({83, 84, 85, 86, 87, 88, 89, 204}),
    ({77, 81, 89, 91, 95, 102, 119, 137, 138, 154, 161, 169}),
    ({76, 92, 93, 94, 95, 96, 97, 98, 108}),
    ({98, 99, 100, 101, 102, 103, 111}),
    ({103, 104, 105, 106}),
    ({104, 106, 107, 108, 109, 110, 111}),
    ({110, 112, 113, 114, 115, 116, 117, 151}),
    ({112, 113, 114, 115, 116, 117, 118}),
    ({119, 124}),
    ({120, 121, 122, 123, 124}),
    ({125, 126, 127, 128, 129, 130, 132}),
    ({131, 133, 134, 135, 136}),
    ({139, 140, 141, 142, 143, 144}),
    ({139, 141, 143, 144, 145, 147}),
    ({145, 146, 147, 148, 149, 150, 151, 152, 153, 205}),
    ({138, 149, 150, 152, 154, 155, 156, 157, 158, 159, 160, 161, 163, 168, 169, 170}),
    ({89, 160, 164, 165, 166, 167, 168, 169}),
    ({170, 171, 172,173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 205}),
    ({185, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203}),
    ({202, 220, 230, 231, 232, 233, 235, 236, 237}),
    ({206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218}),
    ({207, 208, 214, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229}),
    ({209, 214, 238, 239, 240, 241, 242, 243, 244, 245, 246}),
    ({214, 221, 226, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256}),
    ({46, 87, 90, 105, 109, 137, 172}),
    ({88, 91, 92, 138, 162, 184})
});

/**
 * @brief 返回魔物列表
 *
 * @param dq    指定所属世界，现在暂未用到，仅支持9，query("dq")
 * @param area  指定所属地区，确定魔物列表，query("area")
 * @param kind  指定加载的魔物种类上限，query("mob")
 * @param max   指定加载种类魔物数量上限，总数最大值为kind*max，query("mob_max")
 * @param range 指定魔物分组范围，query("mob_range")
 * @return varargs
 */
varargs mapping mob(int dq, int area, int kind, int max, int range)
{
    int *mob, i;
    mapping mob_list = ([]);
    if (!dq)
    {
        dq = 9;
    }

    if (area < 1 || kind < 1 ||
        sizeof(area_mob) <= area ||
        !sizeof(mob = area_mob[area]))
    {
        return mob_list;
    }

    if (range)
        mob = slice(mob, range);

    if (max < 1)
        max = 1;

    for (i = 0; i < kind; i++)
    {
        mob_list += ([MOB_DIR + dq + "/" + element_of(mob):1 + random(max),]);
    }
    return mob_list;
}

void create()
{
    // debug_message();
}

// 数组切分３部分，方便控制地区怪物范围
// 0 0 0 : 高4 中2 初1
int *slice(int *mob, int range)
{
    int i;
    int *mob1, *mob2, *mob3;
    if (!range || range > 6)
        return mob;
    i = sizeof(mob) / 3;
    mob1 = mob[0..i];
    mob2 = mob[i..i * 2];
    mob3 = mob[i * 2..];

    return (range & 1 ? mob1 : ({})) + (range & 2 ? mob2 : ({})) + (range & 4 ? mob3 : ({}));
}

varargs int *mob_list(int area, int range)
{
    if (area < 1 || area >= sizeof(area_mob))
    {
        area = 1 + random(sizeof(area_mob) - 1);
    }

    return slice(area_mob[area], range);
}
